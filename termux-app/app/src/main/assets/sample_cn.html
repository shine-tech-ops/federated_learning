<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>联邦学习助手</title>
    <script>window.injectInfo = {env: "PROD"};</script>
    <script>window.publicPath = "./static";</script>
    <script data-logging-script="true"
            src="./static/mini-app-log.js"></script>
    <script defer="" src="./static/mini-app-base.js"></script>
    <script defer="" src="./static/tailwind4.1.13.js"></script>
    <script src="./static/axios.js"></script>
    <link href="./static/material-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #F9FAFB;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            /*user-select: none;*/
        }

        .container {
            margin-left: 0;
            margin-right: 0;
            border-radius: 8px;
            min-height: 100vh;
            background: linear-gradient(135deg, #F9FAFB 0%, #F3F4F6 100%);
        }

        .model-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(94, 159, 249, 0.1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .model-card.active {
            border-color: #5E9FF9;
            box-shadow: 0 4px 16px rgba(94, 159, 249, 0.2);
        }

        .model-card:hover {
            border-color: #5E9FF9;
            box-shadow: 0 2px 8px rgba(94, 159, 249, 0.15);
        }

        .model-card.selected {
            border-color: #5E9FF9;
            background: rgba(94, 159, 249, 0.1);
            box-shadow: 0 2px 8px rgba(94, 159, 249, 0.2);
        }

        .chat-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }

        .slider {
            -webkit-appearance: none;
            appearance: none;
            height: 6px;
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.1);
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #5E9FF9;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #5E9FF9;
            cursor: pointer;
        }

        .progress-bar {
            background: rgba(94, 159, 249, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: #5E9FF9;
            height: 100%;
            transition: width 0.3s ease;
        }

        .btn-primary {
            background: #5E9FF9;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-primary:hover {
            background: #4B8FE8;
            transform: translateY(-1px);
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: transparent;
            color: #5E9FF9;
            border: 2px solid #5E9FF9;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: #5E9FF9;
            color: white;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-active {
            background: #10B981;
            animation: pulse 2s infinite;
        }

        .status-training {
            background: #5E9FF9;
            animation: pulse 1s infinite;
        }

        .status-idle {
            background: #6B7280;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(94, 159, 249, 0.1);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            border-color: #5E9FF9;
            box-shadow: 0 2px 8px rgba(94, 159, 249, 0.15);
        }

        .task-item.selected {
            border-color: #5E9FF9;
            background: rgba(94, 159, 249, 0.1);
            box-shadow: 0 2px 8px rgba(94, 159, 249, 0.2);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
    </style>
    <style>/*! tailwindcss v4.1.13 | MIT License | https://tailwindcss.com */
    @layer properties;
    @layer theme, base, components, utilities;
    @layer theme {
        :root, :host {
            --font-sans: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol',
            'Noto Color Emoji';
            --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New',
            monospace;
            --color-red-600: oklch(57.7% 0.245 27.325);
            --color-yellow-600: oklch(68.1% 0.162 75.834);
            --color-green-500: oklch(72.3% 0.219 149.579);
            --color-green-600: oklch(62.7% 0.194 149.214);
            --color-blue-500: oklch(62.3% 0.214 259.815);
            --color-blue-600: oklch(54.6% 0.245 262.881);
            --color-blue-700: oklch(48.8% 0.243 264.376);
            --color-purple-500: oklch(62.7% 0.265 303.9);
            --color-purple-600: oklch(55.8% 0.288 302.321);
            --color-gray-50: oklch(98.5% 0.002 247.839);
            --color-gray-200: oklch(92.8% 0.006 264.531);
            --color-gray-300: oklch(87.2% 0.01 258.338);
            --color-gray-400: oklch(70.7% 0.022 261.325);
            --color-gray-500: oklch(55.1% 0.027 264.364);
            --color-gray-600: oklch(44.6% 0.03 256.802);
            --color-gray-700: oklch(37.3% 0.034 259.733);
            --color-gray-800: oklch(27.8% 0.033 256.848);
            --color-white: #fff;
            --spacing: 0.25rem;
            --text-xs: 0.75rem;
            --text-xs--line-height: calc(1 / 0.75);
            --text-sm: 0.875rem;
            --text-sm--line-height: calc(1.25 / 0.875);
            --text-lg: 1.125rem;
            --text-lg--line-height: calc(1.75 / 1.125);
            --text-2xl: 1.5rem;
            --text-2xl--line-height: calc(2 / 1.5);
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            --radius-lg: 0.5rem;
            --default-font-family: var(--font-sans);
            --default-mono-font-family: var(--font-mono);
        }
    }
    @layer base {
        *, ::after, ::before, ::backdrop, ::file-selector-button {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            border: 0 solid;
        }

        html, :host {
            line-height: 1.5;
            -webkit-text-size-adjust: 100%;
            tab-size: 4;
            font-family: ui-sans-serif, system-ui, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            -webkit-tap-highlight-color: transparent;
        }

        hr {
            height: 0;
            color: inherit;
            border-top-width: 1px;
        }

        abbr:where([title]) {
            text-decoration: underline dotted;
        }

        h1, h2, h3, h4, h5, h6 {
            font-size: inherit;
            font-weight: inherit;
        }

        a {
            color: inherit;
            text-decoration: inherit;
        }

        b, strong {
            font-weight: bolder;
        }

        code, kbd, samp, pre {
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            font-size: 1em;
        }

        small {
            font-size: 80%;
        }

        sub, sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline;
        }

        sub {
            bottom: -0.25em;
        }

        sup {
            top: -0.5em;
        }

        table {
            text-indent: 0;
            border-color: inherit;
            border-collapse: collapse;
        }

        :-moz-focusring {
            outline: auto;
        }

        progress {
            vertical-align: baseline;
        }

        summary {
            display: list-item;
        }

        ol, ul, menu {
            list-style: none;
        }

        img, svg, video, canvas, audio, iframe, embed, object {
            display: block;
            vertical-align: middle;
        }

        img, video {
            max-width: 100%;
            height: auto;
        }

        button, input, select, optgroup, textarea, ::file-selector-button {
            font: inherit;
            font-feature-settings: inherit;
            font-variation-settings: inherit;
            letter-spacing: inherit;
            color: inherit;
            border-radius: 0;
            background-color: transparent;
            opacity: 1;
        }

        :where(select:is([multiple], [size])) optgroup {
            font-weight: bolder;
        }

        :where(select:is([multiple], [size])) optgroup option {
            padding-inline-start: 20px;
        }

        ::file-selector-button {
            margin-inline-end: 4px;
        }

        ::placeholder {
            opacity: 1;
        }

        @supports (contain-intrinsic-size: 1px) {
            ::placeholder {
                color: currentcolor;
                @supports (color: color-mix(in lab, red, red)) {
                    color: color-mix(in oklab, currentcolor 50%, transparent);
                }
            }
        }
        textarea {
            resize: vertical;
        }

        ::-webkit-search-decoration {
            -webkit-appearance: none;
        }

        ::-webkit-date-and-time-value {
            min-height: 1lh;
            text-align: inherit;
        }

        ::-webkit-datetime-edit-fields-wrapper {
            padding: 0;
        }

        ::-webkit-datetime-edit-year-field, ::-webkit-datetime-edit-month-field, ::-webkit-datetime-edit-day-field, ::-webkit-datetime-edit-hour-field {
            padding-block: 0;
        }

        ::-webkit-calendar-picker-indicator {
            line-height: 1;
        }

        :-moz-ui-invalid {
            box-shadow: none;
        }

        button, input:where([type='button'], [type='reset'], [type='submit']), ::file-selector-button {
            appearance: button;
        }

        ::-webkit-inner-spin-button, ::-webkit-outer-spin-button {
            height: auto;
        }

        [hidden]:where(:not([hidden='until-found'])) {
            display: none !important;
        }
    }
    @layer utilities {
        .container {
            width: 100%;
            @media (width >= 40rem) {
                max-width: 40rem;
            }
            @media (width >= 48rem) {
                max-width: 48rem;
            }
            @media (width >= 64rem) {
                max-width: 64rem;
            }
            @media (width >= 80rem) {
                max-width: 80rem;
            }
            @media (width >= 96rem) {
                max-width: 96rem;
            }
        }

        .mt-1 {
            margin-top: calc(var(--spacing) * 1);
        }

        .mt-3 {
            margin-top: calc(var(--spacing) * 3);
        }

        .mt-4 {
            margin-top: calc(var(--spacing) * 4);
        }

        .mr-1 {
            margin-right: calc(var(--spacing) * 1);
        }

        .mb-2 {
            margin-bottom: calc(var(--spacing) * 2);
        }

        .mb-3 {
            margin-bottom: calc(var(--spacing) * 3);
        }

        .mb-4 {
            margin-bottom: calc(var(--spacing) * 4);
        }

        .mb-6 {
            margin-bottom: calc(var(--spacing) * 6);
        }

        .ml-1 {
            margin-left: calc(var(--spacing) * 1);
        }

        .block {
            display: block;
        }

        .flex {
            display: flex;
        }

        .grid {
            display: grid;
        }

        .h-2 {
            height: calc(var(--spacing) * 2);
        }

        .h-64 {
            height: calc(var(--spacing) * 64);
        }

        .h-72 {
            height: calc(var(--spacing) * 72);
        }

        .w-full {
            width: 100%;
        }

        .flex-1 {
            flex: 1;
        }

        .cursor-pointer {
            cursor: pointer;
        }

        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }

        .grid-cols-3 {
            grid-template-columns: repeat(3, minmax(0, 1fr));
        }

        .items-center {
            align-items: center;
        }

        .justify-between {
            justify-content: space-between;
        }

        .justify-start {
            justify-content: flex-start;
        }

        .gap-2 {
            gap: calc(var(--spacing) * 2);
        }

        .gap-3 {
            gap: calc(var(--spacing) * 3);
        }

        .space-y-2 {
            :where(& > :not(:last-child)) {
                --tw-space-y-reverse: 0;
                margin-block-start: calc(calc(var(--spacing) * 2) * var(--tw-space-y-reverse));
                margin-block-end: calc(calc(var(--spacing) * 2) * calc(1 - var(--tw-space-y-reverse)));
            }
        }

        .space-y-3 {
            :where(& > :not(:last-child)) {
                --tw-space-y-reverse: 0;
                margin-block-start: calc(calc(var(--spacing) * 3) * var(--tw-space-y-reverse));
                margin-block-end: calc(calc(var(--spacing) * 3) * calc(1 - var(--tw-space-y-reverse)));
            }
        }

        .overflow-y-auto {
            overflow-y: auto;
        }

        .rounded-lg {
            border-radius: var(--radius-lg);
        }

        .border {
            border-style: var(--tw-border-style);
            border-width: 1px;
        }

        .border-gray-200 {
            border-color: var(--color-gray-200);
        }

        .border-gray-300 {
            border-color: var(--color-gray-300);
        }

        .bg-gray-50 {
            background-color: var(--color-gray-50);
        }

        .bg-white {
            background-color: var(--color-white);
        }

        .p-3 {
            padding: calc(var(--spacing) * 3);
        }

        .p-4 {
            padding: calc(var(--spacing) * 4);
        }

        .px-3 {
            padding-inline: calc(var(--spacing) * 3);
        }

        .px-4 {
            padding-inline: calc(var(--spacing) * 4);
        }

        .px-6 {
            padding-inline: calc(var(--spacing) * 6);
        }

        .py-2 {
            padding-block: calc(var(--spacing) * 2);
        }

        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .align-middle {
            vertical-align: middle;
        }

        .text-2xl {
            font-size: var(--text-2xl);
            line-height: var(--text-2xl--line-height);
        }

        .text-lg {
            font-size: var(--text-lg);
            line-height: var(--text-lg--line-height);
        }

        .text-sm {
            font-size: var(--text-sm);
            line-height: var(--text-sm--line-height);
        }

        .text-xs {
            font-size: var(--text-xs);
            line-height: var(--text-xs--line-height);
        }

        .font-bold {
            --tw-font-weight: var(--font-weight-bold);
            font-weight: var(--font-weight-bold);
        }

        .font-medium {
            --tw-font-weight: var(--font-weight-medium);
            font-weight: var(--font-weight-medium);
        }

        .font-semibold {
            --tw-font-weight: var(--font-weight-semibold);
            font-weight: var(--font-weight-semibold);
        }

        .text-blue-500 {
            color: var(--color-blue-500);
        }

        .text-blue-600 {
            color: var(--color-blue-600);
        }

        .text-gray-400 {
            color: var(--color-gray-400);
        }

        .text-gray-500 {
            color: var(--color-gray-500);
        }

        .text-gray-600 {
            color: var(--color-gray-600);
        }

        .text-gray-700 {
            color: var(--color-gray-700);
        }

        .text-gray-800 {
            color: var(--color-gray-800);
        }

        .text-green-500 {
            color: var(--color-green-500);
        }

        .text-green-600 {
            color: var(--color-green-600);
        }

        .text-purple-500 {
            color: var(--color-purple-500);
        }

        .text-purple-600 {
            color: var(--color-purple-600);
        }

        .text-red-600 {
            color: var(--color-red-600);
        }

        .text-yellow-600 {
            color: var(--color-yellow-600);
        }

        .hover\:text-blue-700 {
            &:hover {
                @media (hover: hover) {
                    color: var(--color-blue-700);
                }
            }
        }

        .focus\:ring-2 {
            &:focus {
                --tw-ring-shadow: var(--tw-ring-inset,) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color, currentcolor);
                box-shadow: var(--tw-inset-shadow), var(--tw-inset-ring-shadow), var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow);
            }
        }

        .focus\:ring-blue-500 {
            &:focus {
                --tw-ring-color: var(--color-blue-500);
            }
        }

        .focus\:outline-none {
            &:focus {
                --tw-outline-style: none;
                outline-style: none;
            }
        }
    }

    @property --tw-space-y-reverse {
        syntax: "*";
        inherits: false;
        initial-value: 0;
    }

    @property --tw-border-style {
        syntax: "*";
        inherits: false;
        initial-value: solid;
    }

    @property --tw-font-weight {
        syntax: "*";
        inherits: false;
    }

    @property --tw-shadow {
        syntax: "*";
        inherits: false;
        initial-value: 0 0 #0000;
    }

    @property --tw-shadow-color {
        syntax: "*";
        inherits: false;
    }

    @property --tw-shadow-alpha {
        syntax: "<percentage>";
        inherits: false;
        initial-value: 100%;
    }

    @property --tw-inset-shadow {
        syntax: "*";
        inherits: false;
        initial-value: 0 0 #0000;
    }

    @property --tw-inset-shadow-color {
        syntax: "*";
        inherits: false;
    }

    @property --tw-inset-shadow-alpha {
        syntax: "<percentage>";
        inherits: false;
        initial-value: 100%;
    }

    @property --tw-ring-color {
        syntax: "*";
        inherits: false;
    }

    @property --tw-ring-shadow {
        syntax: "*";
        inherits: false;
        initial-value: 0 0 #0000;
    }

    @property --tw-inset-ring-color {
        syntax: "*";
        inherits: false;
    }

    @property --tw-inset-ring-shadow {
        syntax: "*";
        inherits: false;
        initial-value: 0 0 #0000;
    }

    @property --tw-ring-inset {
        syntax: "*";
        inherits: false;
    }

    @property --tw-ring-offset-width {
        syntax: "<length>";
        inherits: false;
        initial-value: 0px;
    }

    @property --tw-ring-offset-color {
        syntax: "*";
        inherits: false;
        initial-value: #fff;
    }

    @property --tw-ring-offset-shadow {
        syntax: "*";
        inherits: false;
        initial-value: 0 0 #0000;
    }

    @layer properties {
        @supports ((-webkit-hyphens: none) and (not (margin-trim: inline))) or ((not (color:rgb(from red r g b)))) {
            *, ::before, ::after, ::backdrop {
                --tw-space-y-reverse: 0;
                --tw-border-style: solid;
                --tw-font-weight: initial;
                --tw-shadow: 0 0 #0000;
                --tw-shadow-color: initial;
                --tw-shadow-alpha: 100%;
                --tw-inset-shadow: 0 0 #0000;
                --tw-inset-shadow-color: initial;
                --tw-inset-shadow-alpha: 100%;
                --tw-ring-color: initial;
                --tw-ring-shadow: 0 0 #0000;
                --tw-inset-ring-color: initial;
                --tw-inset-ring-shadow: 0 0 #0000;
                --tw-ring-inset: initial;
                --tw-ring-offset-width: 0px;
                --tw-ring-offset-color: #fff;
                --tw-ring-offset-shadow: 0 0 #0000;
            }
        }
    }
    </style>
    <style>
        #chatInput {
            width: 100%;
            font-size: 14px;
            transition: all 0.15s ease-in-out;
        }
        #chatInput:hover, #chatInput:active, #chatInput:focus {
            border-color: #4B8FE8;
            border-width: 2px;
            outline: none;
        }
    </style>
    <script type="text/javascript">
        // 打开终端
        function openTerminal() {
            if (typeof Android !== 'undefined') {
                Android.closeWindow();
            }
        }
        // 设置设备状态（Android Received）
        let reset_device_status_timeout = null
        function onDeviceInfoReceived(device_info) {
            // 设置训练任务模型
            const setTrainTaskModel = ({ name, description }) => {
                document.getElementById('modelName').innerHTML = name;
                document.getElementById('modelDescription').innerHTML = description;
            }
            // 设置训练任务信息
            const setTrainTaskInfo = ({ id, name }) => {
                document.getElementById('taskID').innerHTML = id;
                document.getElementById('taskName').innerHTML = name;
            }
            // 设置训练任务参数
            const setTrainTaskArguments = (data) => {
                const { index, round, aggregation_method, progress, accuracy, loss, correct, total } = data;
                document.getElementById('progressText').innerHTML = progress + "%";
                document.getElementById('epochCount').innerHTML = index + "/" + round;
                document.getElementById('aggregationMethod').innerHTML = aggregation_method;
                document.getElementById('accuracy').innerHTML = accuracy;
                document.getElementById('loss').innerHTML = loss;
                document.getElementById('correct').innerHTML = correct;
                document.getElementById('sampleCount').innerHTML = total;

                const taskStatus = document.getElementById('taskStatus');
                if (taskStatus.classList.contains('status-idle')) {
                    taskStatus.classList.remove('status-idle');
                    taskStatus.classList.add('status-active');
                }
                if (progress > 0 && progress < 100) {
                    if (taskStatus.classList.contains('status-active')) {
                        taskStatus.classList.remove('status-active');
                    }
                    if (!taskStatus.classList.contains('status-training')) {
                        taskStatus.classList.add('status-training');
                    }
                }
            }

            try {
                // 如果传递的是字符串，需要解析
                if (typeof device_info === 'string') {
                    device_info = JSON.parse(device_info);
                }
                // 处理数据...
                console.log('接收到的设备信息:', JSON.stringify(device_info));
                const { id, status, timestamp, description } = device_info['device'];
                console.log(timestamp);
                console.log(description);
                const connectionStatus = document.getElementById('connectionStatus');
                if (status === 'online') {
                    clearTimeout(reset_device_status_timeout);
                    if (connectionStatus.classList.contains('status-idle')) {
                        connectionStatus.classList.remove('status-idle');
                        connectionStatus.classList.add('status-active');
                    }
                    document.getElementById('connectionText').innerHTML = '设备' + id + '在线';
                    // 设置训练任务模型
                    setTrainTaskModel(device_info['model']);
                    // 设置训练任务信息
                    setTrainTaskInfo(device_info['task']);
                    // 设置训练任务参数
                    setTrainTaskArguments(device_info['train']);
                }
                reset_device_status_timeout = setTimeout(function () {
                    connectionStatus.classList.remove('status-active');
                    connectionStatus.classList.remove('status-training');
                    connectionStatus.classList.add('status-idle');
                }, 60 * 1000);
            } catch (error) {
                console.error('处理设备信息时出错:', error);
            }
        }

        // 更新训练任务

        // dev
        document.addEventListener('DOMContentLoaded', () => {
            // onDeviceInfoReceived({
            //     "task": {
            //         "id": "",
            //         "name": ""
            //     },
            //     "model": {
            //         "id": "",
            //         "name": "",
            //         "description": "",
            //         "file": ""
            //     },
            //     "train": {
            //         "index": 0,
            //         "round": 0,
            //         "aggregation_method": null,
            //         "progress": 0,
            //         "accuracy": 0,
            //         "loss": 0,
            //         "correct": 0,
            //         "total": 0
            //     },
            //     "device": {
            //         "id": "device_xxx",
            //         "status": "online",
            //         "timestamp": 1000000,
            //         "description": ""
            //     },
            //     "flower_server": {
            //         "host": "127.0.0.1",
            //         "port": 8080,
            //         "server_id": "",
            //         "running": ""
            //     }
            // });
        });

    </script>
</head>
<body
    style="margin: 0 !important; padding: 0 !important; display: flex !important; align-items: center !important; justify-content: center !important;">
<div class="container p-4 w-full" id="container" style="margin: 0 !important; padding-top: 6.5rem !important;">
    <!-- 头部状态栏 -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-800 mb-2">联邦学习助手</h1>
        <div class="flex items-center justify-between text-sm text-gray-600">
            <div class="flex items-center justify-center">
                <span class="status-indicator status-idle" id="connectionStatus"></span>
                <span id="connectionText" style="margin-right: 12px;">设备断开</span>
            </div>
            <div class="flex items-center justify-center" id="openTerminal" onclick="openTerminal()">
                <span class="material-icons text-blue-500 mr-1" style="font-size: 20px">terminal</span>
                <span class="text-blue-500" style="margin-right: 12px;">打开终端</span>
            </div>
        </div>
    </div>

    <!-- 模型选择区域 -->
    <div class="mb-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">功能选择</h2>

        <div class="grid grid-cols-2 gap-3">
            <div class="model-card rounded-lg p-3 text-center active" data-testid="small-model-card"
                 id="smallModelCard">
                <span class="material-icons text-blue-500 mb-2">memory</span>
                <div class="text-sm font-medium text-gray-800">训练</div>
                <div class="text-xs text-gray-500 mt-1">本地模型训练</div>
            </div>
            <div class="model-card rounded-lg p-3 text-center" data-testid="large-model-card" id="largeModelCard">
                <span class="material-icons text-blue-500 mb-2">chat</span>
                <div class="text-sm font-medium text-gray-800">对话</div>
                <div class="text-xs text-gray-500 mt-1">云端大模型对话</div>
            </div>
        </div>

        <!-- 大模型列表 -->
        <div class="mt-4" id="largeModelList" style="display: none;">
            <h3 class="text-sm font-medium text-gray-700 mb-3">选择大模型</h3>
            <div class="space-y-2">
                <div class="model-card rounded-lg p-3 cursor-pointer" data-large-model="gpt-4"
                     data-testid="large-model-gpt4">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium text-sm text-gray-800">GPT-4</div>
                            <div class="text-xs text-gray-500">强大的多模态AI模型</div>
                        </div>
                        <span class="material-icons text-blue-500">smart_toy</span>
                    </div>
                </div>
                <div class="model-card rounded-lg p-3 cursor-pointer" data-large-model="claude-3"
                     data-testid="large-model-claude3">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium text-sm text-gray-800">Claude-3</div>
                            <div class="text-xs text-gray-500">专业的对话AI助手</div>
                        </div>
                        <span class="material-icons text-purple-500">psychology</span>
                    </div>
                </div>
                <div class="model-card rounded-lg p-3 cursor-pointer" data-large-model="gemini-pro"
                     data-testid="large-model-gemini">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="font-medium text-sm text-gray-800">Gemini Pro</div>
                            <div class="text-xs text-gray-500">Google的先进AI模型</div>
                        </div>
                        <span class="material-icons text-green-500">auto_awesome</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 训练任务区域 -->
    <div class="mb-6" style="display: block; opacity: 1; transition: opacity 0.3s ease-in-out;">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">训练任务</h2>

        <!-- 任务列表 -->
        <div class="mb-4">
            <div class="flex items-center justify-between mb-3" style="display: none">
                <h3 class="text-sm font-medium text-gray-700">可选任务</h3>
                <button class="text-xs text-blue-600 hover:text-blue-700" data-testid="refresh-tasks-btn"
                        id="refreshTasksBtn">
                    <span class="material-icons text-sm align-middle mr-1">refresh</span>
                    刷新
                </button>
            </div>
        </div>

        <!-- 当前任务详情 -->
        <div class="model-card rounded-lg p-4 selected">
            <div class="flex items-center justify-between mb-3">
                <div>
                    <div class="font-medium text-gray-800" id="modelName">---</div>
                    <div class="text-sm text-gray-500" id="modelDescription">---</div>
                </div>
                <span class="status-indicator status-idle" id="taskStatus"></span>
            </div>

            <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>训练进度</span>
                    <span id="progressText">-%</span>
                </div>
                <div class="progress-bar h-2">
                    <div class="progress-fill" id="progressFill" style="width: 0"></div>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-3 text-sm">
                <div>
                    <span class="text-gray-500">任务ID:</span>
                    <span class="font-medium text-gray-800 ml-1" id="taskID">--</span>
                </div>
                <div>
                    <span class="text-gray-500">任务名称:</span>
                    <span class="font-medium text-gray-800 ml-1" id="taskName">--</span>
                </div>
                <div>
                    <span class="text-gray-500">训练轮次:</span>
                    <span class="font-medium text-gray-800 ml-1" id="epochCount">-/-</span>
                </div>
                <div>
                    <span class="text-gray-500">聚合方法:</span>
                    <span class="font-medium text-gray-800 ml-1" id="aggregationMethod">-</span>
                </div>
                <div>
                    <span class="text-gray-500">准确率:</span>
                    <span class="font-medium text-gray-800 ml-1" id="accuracy">-</span>
                </div>
                <div>
                    <span class="text-gray-500">正确预测数:</span>
                    <span class="font-medium text-gray-800 ml-1" id="correct">-</span>
                </div>
                <div>
                    <span class="text-gray-500">总样本数:</span>
                    <span class="font-medium text-gray-800 ml-1" id="sampleCount">-</span>
                </div>
                <div class="col-span-2">
                    <span class="text-gray-500">损失值:</span>
                    <span class="font-medium text-gray-800 ml-1" id="loss">-</span>
                </div>
            </div>
        </div>
    </div>

    <!-- 对话区域 -->
    <div class="mb-6">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">模型对话</h2>
        <div class="model-card rounded-lg p-4">
            <div class="bg-gray-50 rounded-lg p-3 h-72 overflow-y-auto mb-4" id="chatContainer">
                <div class="space-y-3" id="chatMessages">
                    <div class="flex justify-start">
                        <div class="chat-bubble bg-white border border-gray-200 rounded-lg p-3">
                            <div class="text-sm text-gray-800">你好！我是联邦学习助手，请问有什么可以帮助你的吗？</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex gap-2">
                <label class="w-100 relative">
                    <textarea
                        id="chatInput"
                        class="block relative input border border-2 p-2 border-gray-200 rounded-lg"
                        style="resize: none"
                        placeholder="Enter your question..."
                    ></textarea>
                    <button class="absolute flex send-btn" id="sendBtn">
                        <span class="material-icons">arrow_upward</span>
                    </button>
                </label>
            </div>

<!--            <div class="flex gap-2">-->
<!--                <label for="chatInput"></label>-->
<!--                <textarea class="flex-1 px-4 py-2 border border-gray-300 border-2 rounded-lg"-->
<!--                       data-testid="chat-input"-->
<!--                       id="chatInput" placeholder="输入您的问题..." type="text"></textarea>-->
<!--                <button class="btn-primary px-6" data-testid="send-btn" id="sendBtn">-->
<!--                    <span class="material-icons text-sm">send</span>-->
<!--                </button>-->
<!--            </div>-->

            <!-- 上传对话按钮 -->
<!--            <div class="mt-3" id="uploadDialogSection">-->
<!--                <button class="btn-secondary w-full" data-testid="upload-dialog-btn" id="uploadDialogBtn">-->
<!--                    <span class="material-icons text-sm mr-1">upload</span>-->
<!--                    上传对话到服务器-->
<!--                </button>-->
<!--            </div>-->
        </div>
    </div>
</div>

<script src="static/app.js"></script>

<script data-logging-script="true">console.log("[MiniApp] body结束前");</script>
</body>
</html>
